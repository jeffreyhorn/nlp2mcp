# Release Notes: v1.2.0

**Release Date:** 2026-02-12  
**Epic:** Epic 4 - Sprint 18: Path Syntax Error Fixes & Emission Improvements  
**Previous Version:** v1.1.0

## Overview

Version 1.2.0 focuses on eliminating path_syntax_error failures in the solve stage. Through systematic analysis and targeted fixes across the emission, parsing, and KKT layers, this release significantly improves solve rates and documents architectural limitations for future work.

**Highlights:**
- **+7 solving models** (13 → 20)
- **-15 path_syntax_error failures** (22 → 7)
- **+3 full pipeline matches** (4 → 7)
- 10 distinct fixes across emission, parsing, and KKT layers
- Comprehensive documentation of architectural limitations
- FIX_ROADMAP.md for Sprint 19+ prioritization

## Metrics Summary

### Sprint 17 to Sprint 18 Comparison

| Metric | Sprint 17 Baseline | Sprint 18 Final | Change |
|--------|-------------------|-----------------|--------|
| Parse Rate | 38.8% (62/160) | 38.4% (61/159*) | -1 model |
| Translate Rate | 80.7% (50/62) | 78.7% (48/61*) | -2 models |
| Solve Rate | 26.0% (13/50) | 41.7% (20/48) | **+7 models** |
| path_syntax_error | 22 | 7 | **-15 errors** |
| Full Pipeline | 2.5% (4/160) | 4.4% (7/159) | **+3 models** |

*Note: mingamma excluded from testing (GAMS lacks psi function)

### Solve-Successful Models (20 total)

The following 20 models successfully solve with PATH after translation:

**Match (solution matches original):**
blend, himmel11, hs62, mathopt1, mathopt2, rbrock, simple_nlp

**Mismatch (solves but solution differs):**
chem, demo1, fdesign, harker, wallmcp, weapons

**Not Compared:**
himmel16, pak, pollut, sample, scarfmcp, transmcp, wall

### Full Pipeline Models (7 total)

Models that complete parse → translate → solve with solution matching original:
- **blend** (new in Sprint 18)
- himmel11
- hs62
- mathopt1
- mathopt2
- rbrock
- simple_nlp

## Fixes Implemented

### Day 2: Element Literal Quoting & Bound Names

#### P1: Context-Aware Element Literal Quoting (7 models)
- **Problem:** Multi-character lowercase element literals (`cod`, `land`, `revenue`) emitted without quotes
- **Solution:** Added `domain_vars` parameter for context-aware quoting
- **GAMS Errors Fixed:** 120, 340
- **Files:** `src/emit/expr_to_gams.py`, `src/emit/equations.py`, `src/emit/original_symbols.py`

#### P3: Valid .fx Bound Names (1 model - himmel16)
- **Problem:** Per-element `.fx` bounds generated invalid names with parentheses (`x_fx(1)`)
- **Solution:** Underscore-based naming (`x_fx_1`)
- **GAMS Error Fixed:** 185
- **Files:** `src/ir/normalize.py`

### Day 3: Lag/Lead, Dynamic Subsets, Variable Initialization

#### P2: Lag/Lead Expression Quoting (2 models - robert, pak)
- **Problem:** Multi-letter lag/lead bases (`tt+1`) incorrectly quoted as `"tt+1"`
- **Solution:** Type-aware `_format_mixed_indices()` for IndexOffset handling
- **GAMS Error Fixed:** 149
- **Files:** `src/emit/expr_to_gams.py`

#### P4: Dynamic Subset Assignment Emission (2 models - abel, qabel)
- **Problem:** Dynamic subsets (`ku(k) = yes$(ord(k) < card(k))`) not stored or emitted
- **Solution:** Added `SetAssignment` dataclass and emission function
- **Files:** `src/ir/symbols.py`, `src/ir/model_ir.py`, `src/ir/parser.py`, `src/emit/original_symbols.py`

#### P5: Variable Initialization (1 model - chem)
- **Problem:** Division by zero in stationarity equations with `log(x)` or `1/x` derivatives
- **Solution:** Initialize variables from `.l` values, lower bounds, or defaults
- **Files:** `src/emit/emit_gams.py`

### Days 4-5: Path Syntax Error Deep Dive

#### Case Sensitivity Fix (2 models - alkyl, bearing)
- **Problem:** Bound multiplier key case mismatch between `.items()` and `.keys()`
- **Solution:** Consistent `.keys()` iteration
- **Files:** `src/kkt/partition.py`

#### Table Wildcard Data Expansion (2 models - chenery, orani)
- **Problem:** Dotted row headers in wildcard tables not expanded correctly
- **Solution:** Added `_expand_table_key()` for dimension matching
- **Files:** `src/emit/original_symbols.py`

#### Dollar Conditional Parenthesization
- **Problem:** Comparison conditions in dollar expressions not parenthesized
- **Solution:** Wrap Binary/Unary/DollarConditional conditions in parentheses
- **Files:** `src/emit/expr_to_gams.py`

#### Wildcard '*' Preservation
- **Problem:** Wildcard `*` quoted in parameter domains
- **Solution:** Never quote `*` in `_quote_symbol()`
- **Files:** `src/emit/original_symbols.py`

### Day 7: Wildcard Domain Fix

#### Preserve Wildcard Domains (2 models - blend, sample)
- **Problem:** Wildcard `*` domains replaced with generated named sets
- **Solution:** Keep `*` in declarations to allow any set/literal indexing
- **GAMS Error Fixed:** 171
- **Files:** `src/emit/original_symbols.py`

## Architectural Limitations Documented

The following issues were identified as requiring architectural changes beyond Sprint 18 scope:

| Issue | Models | Description | Priority |
|-------|--------|-------------|----------|
| ISSUE_670 | 6 | Cross-indexed sums in stationarity equations | P1 (Sprint 19) |
| ISSUE_392 | 1 | Table `+` continuation parsing | P2 |
| ISSUE_399 | 1 | Table description as column header | P3 |
| ISSUE_672 | 2 | MCP pairing inconsistencies | P4 |

See `docs/planning/EPIC_4/SPRINT_18/FIX_ROADMAP.md` for detailed Sprint 19 recommendations.

## Known Issues

### Remaining path_syntax_error Models (7)

| Model | Error | Root Cause |
|-------|-------|------------|
| abel | E149 | Cross-indexed sums |
| qabel | E149 | Cross-indexed sums |
| chenery | E149 | Cross-indexed sums |
| mexss | E149 | Cross-indexed sums |
| orani | E149 | Cross-indexed sums |
| robert | E170 | Table parsing + cross-indexed sums |
| like | E170 | Table continuation parsing |

### Excluded Model

- **mingamma:** GAMS lacks the `psi` (digamma) function required for gamma derivative computation. Model excluded from testing.

## Migration Notes

### From v1.1.0 to v1.2.0

No breaking changes. All improvements are additive:
- Existing MCP files will regenerate with improved syntax
- Variable initialization section added to generated code
- SetAssignment handling added for dynamic subsets

### Regenerating MCP Files

To regenerate MCP files with Sprint 18 improvements:
```bash
python scripts/gamslib/regenerate_mcp.py --model <model_name>
```

## Documentation Updates

### New Files
- `docs/planning/EPIC_4/SPRINT_18/FIX_ROADMAP.md` - Sprint 19+ prioritized roadmap
- `docs/releases/v1.2.0.md` - This file

### Updated Files
- `CHANGELOG.md` - Sprint 18 changes
- `docs/testing/GAMSLIB_STATUS.md` - Sprint 18 metrics
- `docs/planning/EPIC_4/SPRINT_18/SPRINT_LOG.md` - Complete 12-day log
- `docs/planning/EPIC_4/SPRINT_18/KNOWN_UNKNOWNS.md` - Sprint 18 findings

### Extended Issue Documentation
- `docs/issues/ISSUE_670_cross-indexed-sums-error-149.md` - Per-model analysis

### Resolved Issues
- ISSUE_674: Wildcard domain missing elements
- ISSUE_676: Gamma/loggamma differentiation

## Testing

### Quality Checks
All quality checks pass:
- `make typecheck`: Success
- `make lint`: All checks passed
- `make test`: 3294 passed, 10 skipped, 1 xfailed

### Pipeline Verification
Full pipeline tested on 159 models (mingamma excluded):
- Parse: 61 (38.4%)
- Translate: 48 (78.7%)
- Solve: 20 (41.7%)
- Match: 7 (53.8% of compared)

## Contributors

Sprint 18 was completed through systematic issue analysis, targeted fixes, and comprehensive documentation.

## What's Next

Sprint 19 priorities (from FIX_ROADMAP.md):
1. **P1: Cross-indexed sums (ISSUE_670)** - 6 models, high ROI
2. **P2: Table continuation (ISSUE_392)** - 1 model
3. **P3: Table description (ISSUE_399)** - 1 model
4. **P4: MCP pairing (ISSUE_672)** - 2 models
